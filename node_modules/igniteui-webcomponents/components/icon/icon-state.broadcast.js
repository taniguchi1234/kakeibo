import { createIconDefaultMap } from './registry/default-map.js';
import { ActionType } from './registry/types.js';
export class IconsStateBroadcast {
    constructor(collections, refsCollection) {
        this.collections = collections;
        this.refsCollection = refsCollection;
        this.iconBroadcastChannel = new BroadcastChannel('ignite-ui-icon-channel');
        this.iconBroadcastChannel.addEventListener('message', this);
    }
    send(data) {
        this.iconBroadcastChannel.postMessage(data);
    }
    handleEvent({ data }) {
        if (data.actionType !== ActionType.SyncState) {
            return;
        }
        this.send({
            actionType: ActionType.SyncState,
            collections: this.getUserSetCollection(this.collections).toMap(),
            references: this.getUserRefsCollection(this.refsCollection).toMap(),
        });
    }
    getUserRefsCollection(collections) {
        const userSetIcons = createIconDefaultMap();
        for (const [collectionKey, collection] of collections.entries()) {
            for (const [iconKey, icon] of collection.entries()) {
                if (icon.external) {
                    userSetIcons.getOrCreate(collectionKey).set(iconKey, icon);
                }
            }
        }
        return userSetIcons;
    }
    getUserSetCollection(collections) {
        const userSetIcons = createIconDefaultMap();
        for (const [collectionKey, collection] of collections.entries()) {
            if (collectionKey === 'internal') {
                continue;
            }
            for (const [iconKey, icon] of collection.entries()) {
                userSetIcons.getOrCreate(collectionKey).set(iconKey, icon);
            }
        }
        return userSetIcons;
    }
}
//# sourceMappingURL=icon-state.broadcast.js.map