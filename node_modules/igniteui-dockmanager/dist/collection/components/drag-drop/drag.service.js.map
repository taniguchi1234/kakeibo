{"version":3,"file":"drag.service.js","sourceRoot":"","sources":["../../../src/components/drag-drop/drag.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { IgcResizerLocation } from '../dockmanager/dockmanager.public-interfaces';\r\n\r\n/**\r\n * @hidden\r\n */\r\nexport interface IgcDragStartEventArguments {\r\n  cancel?: boolean;\r\n  clientX: number;\r\n  clientY: number;\r\n}\r\n\r\n/**\r\n * @hidden\r\n */\r\nexport interface IgcDragEventArguments {\r\n  offsetX: number;\r\n  offsetY: number;\r\n  clientX: number;\r\n  clientY: number;\r\n}\r\n\r\n/**\r\n * @hidden\r\n */\r\nexport interface IgcDragResizeEventArguments {\r\n  dragMoveArgs: IgcDragMoveEventArguments;\r\n  resizerLocation: IgcResizerLocation;\r\n}\r\n\r\n/**\r\n * @hidden\r\n */\r\nexport interface IgcDragMoveEventArguments extends IgcDragEventArguments {\r\n  totalOffsetX?: number;\r\n  totalOffsetY?: number;\r\n  cancel?: boolean;\r\n}\r\n\r\nexport const IGNORE_DRAG = 'data-ignore-drag';\r\n\r\n/**\r\n * @hidden\r\n */\r\nexport class IgcDragService {\r\n  private startX: number;\r\n  private startY: number;\r\n  private lastX: number;\r\n  private lastY: number;\r\n  private currentX: number;\r\n  private currentY: number;\r\n  private dragStarted: boolean;\r\n  private forcedDrag: boolean;\r\n  private _capturedElement: HTMLElement;\r\n\r\n  private get captureTarget(): HTMLElement {\r\n    return this._capturedElement || this.element;\r\n  }\r\n  private set captureTarget(val: HTMLElement) {\r\n    this._capturedElement = val;\r\n  }\r\n\r\n  dragTolerance = 5;\r\n  dragEdgeTolerance = 0;\r\n  dragStart: (eventArgs: IgcDragStartEventArguments) => void;\r\n  dragEnd: (eventArgs: IgcDragEventArguments) => void;\r\n  dragMove: (eventArgs: IgcDragMoveEventArguments) => void;\r\n\r\n  constructor(private element: HTMLElement) {\r\n    this.element.addEventListener('pointerdown', this.handlePointerDown, false);\r\n  }\r\n\r\n  private triggerDragStart() {\r\n    if (this.dragStart) {\r\n      const args: IgcDragStartEventArguments = {\r\n        clientX: this.startX,\r\n        clientY: this.startY\r\n      };\r\n\r\n      this.dragStart(args);\r\n\r\n      if (args.cancel) {\r\n        this.unsubscribeDragEvents();\r\n        return;\r\n      }\r\n    }\r\n\r\n    this.dragStarted = true;\r\n  }\r\n\r\n  private subscribeDragEvents() {\r\n    this.dragStarted = false;\r\n    document.addEventListener('pointermove', this.handlePointerMove, false);\r\n    document.addEventListener('pointerup', this.handlePointerUp, false);\r\n    document.addEventListener('wheel', this.handleWheel, { passive: false });\r\n  }\r\n\r\n  private unsubscribeDragEvents() {\r\n    document.removeEventListener('pointermove', this.handlePointerMove);\r\n    document.removeEventListener('pointerup', this.handlePointerUp);\r\n    document.removeEventListener('wheel', this.handleWheel);\r\n  }\r\n\r\n  private handleWheel = (event: WheelEvent) => {\r\n    event.preventDefault();\r\n  }\r\n\r\n  private handlePointerDown = (event: PointerEvent) => {\r\n    let targets = event.composedPath();\r\n    targets = targets.slice(0, targets.indexOf(event.currentTarget));\r\n    for (const target of targets) {\r\n      if (target instanceof Element\r\n        && target.hasAttribute(IGNORE_DRAG)) {\r\n        return;\r\n      }\r\n    }\r\n    // TODO Not sure if we need this\r\n    // this.element.focus();\r\n    // event.preventDefault();\r\n    this.startX = event.clientX;\r\n    this.startY = event.clientY;\r\n    this.lastX = this.startX;\r\n    this.lastY = this.startY;\r\n\r\n    this.captureTarget = event.target as HTMLElement;\r\n    this.captureTarget.setPointerCapture(event.pointerId);\r\n    this.subscribeDragEvents();\r\n  }\r\n\r\n  private handlePointerMove = (event: PointerEvent) => {\r\n    event.preventDefault();\r\n\r\n    const maxHeight = document.documentElement.clientHeight;\r\n    const maxWidth = document.documentElement.clientWidth;\r\n\r\n    if (event.clientX < this.dragEdgeTolerance) {\r\n      this.currentX = this.dragEdgeTolerance;\r\n    } else if (event.clientX > maxWidth - this.dragEdgeTolerance) {\r\n      this.currentX = maxWidth - this.dragEdgeTolerance;\r\n    } else {\r\n      this.currentX = event.clientX;\r\n    }\r\n\r\n    if (event.clientY < this.dragEdgeTolerance) {\r\n      this.currentY = this.dragEdgeTolerance;\r\n    } else if (event.clientY > maxHeight - this.dragEdgeTolerance) {\r\n      this.currentY = maxHeight - this.dragEdgeTolerance;\r\n    } else {\r\n      this.currentY = event.clientY;\r\n    }\r\n\r\n    if (!this.dragStarted) {\r\n      if (this.forcedDrag) {\r\n        this.forcedDrag = false;\r\n        this.startX = this.currentX;\r\n        this.startY = this.currentY;\r\n        this.lastX = this.startX;\r\n        this.lastY = this.startY;\r\n        this.captureTarget.setPointerCapture(event.pointerId);\r\n        this.triggerDragStart();\r\n      } else {\r\n        const offsetX = this.currentX - this.lastX;\r\n        const offsetY = this.currentY - this.lastY;\r\n\r\n        if (Math.abs(offsetX) > this.dragTolerance || Math.abs(offsetY) > this.dragTolerance) {\r\n          this.triggerDragStart();\r\n        }\r\n      }\r\n    }\r\n\r\n    if (!this.dragStarted) {\r\n      return;\r\n    }\r\n\r\n    if (this.dragMove) {\r\n      const args: IgcDragMoveEventArguments = {\r\n        offsetX: this.currentX - this.lastX,\r\n        offsetY: this.currentY - this.lastY,\r\n        totalOffsetX: this.currentX - this.startX,\r\n        totalOffsetY: this.currentY - this.startY,\r\n        clientX: this.currentX,\r\n        clientY: this.currentY\r\n      };\r\n      this.dragMove(args);\r\n\r\n      if (args.cancel) {\r\n        this.unsubscribeDragEvents();\r\n      }\r\n    }\r\n\r\n    this.lastX = this.currentX;\r\n    this.lastY = this.currentY;\r\n  }\r\n\r\n  private handlePointerUp = (event: PointerEvent) => {\r\n    this.unsubscribeDragEvents();\r\n    this.captureTarget.releasePointerCapture(event.pointerId);\r\n    if (this.dragStarted && this.dragEnd) {\r\n      this.dragEnd({\r\n        offsetX: this.currentX - this.startX,\r\n        offsetY: this.currentY - this.startY,\r\n        clientX: event.clientX,\r\n        clientY: event.clientY\r\n      });\r\n    }\r\n  }\r\n\r\n  destroy() {\r\n    this.element.removeEventListener('pointerdown', this.handlePointerDown);\r\n    this.unsubscribeDragEvents();\r\n    this.element = null;\r\n    this.dragStart = null;\r\n    this.dragEnd = null;\r\n    this.dragMove = null;\r\n  }\r\n\r\n  forceDragging() {\r\n    this.forcedDrag = true;\r\n    this.subscribeDragEvents();\r\n  }\r\n}\r\n"]}